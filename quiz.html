<script>
  const steps = document.querySelectorAll('.form-step');
  let currentStep = 0;

  showStep(currentStep);

  function showStep(stepIndex) {
    steps.forEach((step, index) => {
      step.classList.toggle('active', index === stepIndex);
    });
  }

  function nextStep() {
    const currentInputs = steps[currentStep].querySelectorAll('[required]');
    let valid = true;

    currentInputs.forEach(input => {
      if (input.type === 'radio' || input.type === 'checkbox') {
        const group = steps[currentStep].querySelectorAll(`[name="${input.name}"]`);
        const oneChecked = Array.from(group).some(el => el.checked);
        if (!oneChecked) valid = false;
      } else {
        if (!input.value.trim()) valid = false;
      }
    });

    if (!valid) {
      alert('Please fill out the required fields before continuing.');
      return;
    }

    if (currentStep < steps.length - 1) {
      currentStep++;
      showStep(currentStep);
    }
  }

  function prevStep() {
    if (currentStep > 0) {
      currentStep--;
      showStep(currentStep);
    }
  }

  document.getElementById('recruitmentForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const data = {};

    // Collect all relevant inputs
    this.querySelectorAll('input[type="text"], input[type="email"], textarea').forEach(input => {
      data[input.name] = input.value || '';
    });

    // Gather all checked checkboxes for 'skills'
    const skillCheckboxes = this.querySelectorAll('input[name="skills"]:checked');
    data['skills'] = Array.from(skillCheckboxes).map(cb => cb.value).join(', ');

    // Get selected radio for 'salesperson'
    const salesperson = this.querySelector('input[name="salesperson"]:checked');
    data['salesperson'] = salesperson ? salesperson.value : '';

    try {
      const response = await fetch('https://script.google.com/macros/s/AKfycbwsCQ8dgQaghnfCDc5SrDCMrznafZ8nyhMAGenKwNJ8nzCvLTfh9zTw_YH9SUzrMAjE/exec', {
        method: 'POST',
        body: new URLSearchParams(data)
      });

      if (response.ok) {
        alert('Form submitted successfully!');
        this.reset();
        currentStep = 0;
        showStep(currentStep);
      } else {
        alert('Submission failed, please try again.');
      }
    } catch (error) {
      alert('Error submitting form: ' + error.message);
    }
  });
</script>
